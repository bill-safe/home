# 项目需求文档

## 项目概述

该项目是一个用于游戏的测试web服务，用户可以通过浏览器直接访问平台进行虚拟物品购买和任务发布，所有支付将在平台内部使用游戏币完成。管理员可分发游戏币并管理物品、任务等信息。

## 功能模块

### 1. 购物模块

- **物品管理**：管理员可以添加、编辑、删除物品，设定物品的数量、价格、描述等信息。
- **库存管理**：物品的库存和价格信息可以根据需要进行更新，并由管理员定期检查库存。
- **虚拟货币支付**：所有支付将通过平台内的游戏币进行，用户可以使用游戏币结算物品购买。管理员可以调整每个物品的价格（以游戏币计价）。

### 2. 委托模块

- **任务发布**：用户可以发布任务（如买入/卖出虚拟物品），设定价格、数量等要求，任务类型可以包括物品兑换、任务完成等。
- **任务接取**：用户可以查看任务列表并选择接取任务。接取后，平台会锁定任务，直到交易完成。
- **任务管理**：用户可以查看自己的任务发布和接取状态，管理员可以管理和审查所有任务。

## 管理员功能

- **游戏币分发**：管理员可以自由分发游戏币给用户，支持手动或批量发放功能。
- **余额管理**：管理员可以查看用户余额，并可以调整游戏币余额。
- **物品定价**：管理员设定物品价格并可随时调整，所有支付均以游戏币计价。

## 支付系统（游戏币）

- **充值与消费**：用户通过平台内的游戏币进行支付，平台内不涉及现金交易。充值和消费都通过平台的内部游戏币系统管理。
- **游戏币转换与管理**：管理后台提供游戏币的发放、扣除和余额查询功能。管理员可以通过后台查看用户的消费记录和游戏币流通情况。
- **余额预警**：当用户的游戏币余额低于某个阈值时，系统可以自动发送提醒通知。

## 前后端分离架构

- **前端**：使用现代化前端框架（如React、Vue等）开发游戏的用户交互界面，确保流畅的用户体验。
- **后端**：后端使用Flask或Django提供RESTful API，支持用户信息、物品管理、任务管理、游戏币支付等功能。
- **数据库**：关系型数据库（如MySQL/PostgreSQL）存储用户数据、游戏币余额、物品信息等。

## Web管理后台

- **用户管理**：管理员可以查看用户信息、游戏币余额和历史交易记录。
- **游戏币管理**：管理员可以查看和分发游戏币、调整游戏币余额、生成历史报告。
- **物品与任务管理**：管理员可以查看和管理所有商品和任务信息，包括定价、库存、发布状态等。

## 部署与维护

- **服务器部署**：项目将部署在云服务器上，用户只需通过浏览器访问即可进行所有操作，无需额外安装软件。
- **部署脚本**：提供简单的部署脚本，支持云服务器或本地服务器快速部署。
- **容器化部署**：使用Docker容器化部署前后端，方便团队协作和跨平台运行。
- **日志与监控**：集成基础的日志系统，监控平台性能和任务状态。

## 安全性

- **用户认证与授权**：使用JWT或OAuth2进行用户认证，确保管理员和普通用户的权限分离。
- **防止滥用**：平台应防止用户滥用游戏币，例如通过发布虚假任务或进行不正当交易。

## 扩展性

- **任务自动化**：可以考虑添加任务的自动化处理功能，比如根据市场需求自动调整任务价格。
- **虚拟物品种类扩展**：未来可以支持更多虚拟物品种类，并根据游戏需求进行扩展。

# 游戏测试Web服务后端开发技术文档

## 技术选型

- **开发语言**：Python 3.x
- **Web框架**：Flask
- **数据库**：MySQL
- **容器化技术**：Docker
- **认证与授权**：JWT（JSON Web Token）

## 模块设计

### 一、用户模块

- **用户注册与登录**
  - 前端通过POST请求将用户的注册信息（用户名、密码等）提交到后端，后端验证并将用户信息存入数据库。注册成功后，返回用户的JWT，前端存储该Token以便后续请求。
  - 登录时，前端传送用户名和密码，后端验证密码正确性，并生成JWT返回给前端，后续请求需在HTTP头部附加此JWT进行身份验证。

- **用户信息查询**
  - 前端通过GET请求获取用户信息，后端通过JWT验证身份，返回用户的详细信息（如余额、用户名等）。

### 二、购物模块

- **物品管理**
  - 管理员通过POST/PUT/DELETE请求来创建、更新和删除物品信息（如名称、价格、库存等）。前端需要提供一个界面，供管理员输入物品数据。
  - 前端通过GET请求获取物品列表，展示所有可购买的物品，后端返回物品信息（价格、描述等）并分页显示。

- **支付功能（游戏币）**
  - 用户在前端选择物品后，发起支付请求，后端接收支付请求，验证用户的游戏币余额是否足够。如果足够，则扣除游戏币并完成购买，返回交易成功的消息；如果余额不足，则返回错误消息。
  - 前端展示购买结果，并显示更新后的游戏币余额。

- **库存管理**
  - 管理员通过接口更新库存数量，前端将请求发送到后端，更新库存数据。管理员可以通过界面查看当前库存状态，前端定期请求后端获取库存信息。

### 三、委托模块

- **任务发布与接取**
  - 用户通过POST请求发布任务，提供任务类型（如物品交换、任务完成等）、数量、价格等信息。任务成功发布后，返回任务的详细信息给前端，前端将任务展示在用户的任务列表中。
  - 前端通过GET请求获取任务列表，显示所有可接取的任务。用户点击“接取任务”时，前端发送接取请求，后端将任务标记为已接取，并锁定该任务，直到交易完成。

- **任务状态管理**
  - 用户通过GET请求查看自己发布或接取的任务状态，后端根据任务ID返回当前任务的状态（如待处理、进行中、已完成等）。
  - 管理员可通过GET请求查看所有任务状态，前端展示任务管理界面，支持任务筛选、排序等操作。

### 四、管理员功能

- **游戏币管理**
  - 管理员通过POST请求向用户账户发放游戏币，前端提供输入框供管理员输入发放的数量。管理员提交请求后，后端更新用户的游戏币余额，并返回操作成功的消息。
  - 前端展示当前用户余额和交易记录，管理员可以实时查看和调整余额。

- **物品定价管理**
  - 管理员可以通过PUT请求修改物品的价格，前端提供定价界面，管理员可设置每个物品的价格。修改完成后，前端刷新显示价格更新。

### 五、支付系统（游戏币）

- **消费**
  - 用户通过GET请求查询自己的余额，后端返回当前游戏币余额，前端显示在用户个人页面。
  - 用户通过POST请求进行支付，后端扣除相应金额，并记录交易日志。支付成功后，返回成功消息给前端，余额信息也更新。

## 数据库设计

- **用户表**：存储用户基本信息、角色、余额等。
- **物品表**：存储物品信息、价格、库存、描述等。
- **任务表**：存储任务信息、任务状态、发布用户、接取用户等。
- **交易记录表**：记录每笔游戏币充值、消费等操作。

## 安全策略

- 使用JWT/OAuth2进行用户认证，保证安全性和灵活性。
- 防范虚假任务和不正当交易，管理员审核任务发布请求，并定期审查任务历史。
- 设计严格的权限控制，确保普通用户不能访问管理员专有功能。

## 部署与维护

- 编写Dockerfile进行容器化部署，后端和前端服务各自独立运行，方便团队协作与部署。
- 提供简单的部署脚本，支持快速搭建开发环境或生产环境。
- 集成日志监控系统，通过后端记录请求日志、交易日志等，方便后期问题追踪与性能监测。

## 扩展性考虑

- 后端支持灵活的接口扩展，可以增加更多虚拟物品种类、任务类型等。
- 支持任务的自动化处理，后期可以根据市场需求自动调整任务价格，减少管理员手动操作。
- 前后端分离架构保证了前端与后端的解耦，方便未来前端技术的更新与扩展。

## 游戏测试Web服务数据库设计

### 一、用户表 (`users`)

| 字段名       | 数据类型          | 说明                      |
| ------------ | ----------------- | ------------------------- |
| id           | INT (PK, 自增)    | 用户唯一ID                |
| username     | VARCHAR(50)       | 用户名（唯一）            |
| password     | VARCHAR(255)      | 密码哈希                  |
| email        | VARCHAR(100)      | 邮箱地址                  |
| role         | ENUM('user','admin') | 用户角色                |
| balance      | DECIMAL(12,2)     | 用户游戏币余额            |
| created_at   | DATETIME          | 注册时间                  |
| updated_at   | DATETIME          | 更新时间                  |

---

### 二、物品表 (`items`)

| 字段名       | 数据类型          | 说明                         |
| ------------ | ----------------- | ---------------------------- |
| id           | INT (PK, 自增)    | 物品唯一ID                   |
| name         | VARCHAR(100)      | 物品名称                     |
| description  | VARCHAR(500)      | 物品描述                     |
| price        | DECIMAL(12,2)     | 物品价格（游戏币）           |
| stock        | INT               | 库存数量                     |
| created_at   | DATETIME          | 创建时间                     |
| updated_at   | DATETIME          | 更新时间                     |

---

### 三、任务表 (`tasks`)

| 字段名         | 数据类型                | 说明                               |
| -------------- | ----------------------- | ---------------------------------- |
| id             | INT (PK, 自增)          | 任务唯一ID                         |
| publisher_id   | INT (FK users.id)       | 发布任务的用户ID                   |
| accepter_id    | INT (FK users.id, nullable) | 接取任务的用户ID（任务未接取时为NULL） |
| item_id        | INT (FK items.id, nullable) | 关联物品ID（可选）               |
| type           | ENUM('exchange', 'task')| 任务类型（兑换、任务完成）          |
| price          | DECIMAL(12,2)           | 任务奖励或价格（游戏币）           |
| quantity       | INT                     | 物品或任务数量                      |
| status         | ENUM('open', 'locked', 'completed', 'cancelled') | 任务状态     |
| created_at     | DATETIME                | 创建时间                           |
| updated_at     | DATETIME                | 更新时间                           |

---

### 四、游戏币交易记录表 (`transactions`)

| 字段名         | 数据类型            | 说明                               |
| -------------- | ------------------- | ---------------------------------- |
| id             | INT (PK, 自增)      | 交易记录唯一ID                     |
| user_id        | INT (FK users.id)   | 交易的用户ID                       |
| amount         | DECIMAL(12,2)       | 交易金额（正数为充值，负数为消费） |
| type           | ENUM('recharge','purchase','reward','admin_adjust') | 交易类型 |
| related_id     | INT (nullable)      | 关联任务或物品ID（可选）           |
| description    | VARCHAR(255)        | 交易描述                           |
| created_at     | DATETIME            | 交易发生时间                       |

---

## 数据库表之间的关系图示：

```
users (用户表)
│
├── items (物品表)
│
├── tasks (任务表)
│    ├── publisher_id -> users.id
│    ├── accepter_id -> users.id
│    └── item_id -> items.id
│
├── transactions (交易记录表)
│    ├── user_id -> users.id
│    └── related_id -> items.id / tasks.id (可选)
│
└── balance_alerts (余额预警记录表)
     └── user_id -> users.id
```

## 索引与优化建议

- 用户表 `username` 字段需建立唯一索引，提高登录速度。
- 任务表的 `publisher_id` 和 `accepter_id` 字段建议分别建立索引，提高任务管理和查询效率。
- 交易记录表的 `user_id` 建立索引，优化用户交易历史查询。

## 数据库技术选型建议

- **MySQL**：
  - 推荐使用InnoDB引擎，支持事务，确保数据一致性。
  - 常规索引及外键约束提高查询和数据完整性。
